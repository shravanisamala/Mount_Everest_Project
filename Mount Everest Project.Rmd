---
title: "R Notebook"
output: html_notebook
---

```{r, Warnings = FALSE}
library(tidyverse)
library(dplyr)
library(mosaic)
library(ggplot2)
```

PEAK ID- This is a unique identifier for the mountain
Name - Name of the climber
Yr/Seas- Year and Season of the ascent
Date- Date of Ascent
Time- Time of Ascent
Citizenship-
Sex
Age
Oxygen - Ascent with/without Oxygen
Dth- Did the ascent result in death?
Host - Country

```{r}
#Import data
myFile <- "https://raw.githubusercontent.com/shravanisamala/Mount_Everest_Project/master/Mt_Everest_Ascent_Data.csv"

MountEverestData <- read.csv(myFile)
#MountEverestData <- read.csv("C:\\Users\\shrav\\Desktop\\Stat 466\\Mount_Everest_Project\\Mt_Everest_Ascent_Data.csv")
colnames(MountEverestData)[1] <- gsub('^...','',colnames(MountEverestData)[1])

head(MountEverestData)

# #Cleaning up data
# MountEverestData <- 
#   MountEverestData %>%
#   rename(Peak = Peak., 
#          Name = Name., 
#          Yr.Seas = Yr.Seas., 
#          Date = Date., 
#          Time = Time., 
#          Citizenship = Citizenship., 
#          Sex = Sex., 
#          Age = Age., 
#          Oxy = Oxy., 
#          Dth = Dth., 
#          Host = Host.)
  
MountEverestData$Dth <- as.factor(ifelse(MountEverestData$Dth == "Y", 1, 0)) #1 = death, 0 = alive
MountEverestData$Oxy <- as.factor(ifelse(MountEverestData$Oxy == "Y", 1, 0)) #1 = death, 0 = alive
MountEverestData$YearOnly <- as.integer(substr(MountEverestData$Yr.Seas, 1, 4))
MountEverestData$Helper <- as.integer(substr(MountEverestData$Yr.Seas, 1, 3))


MountEverestData <- 
MountEverestData %>% mutate(Decade =
                     case_when(Helper == 195 ~ "1950",
                               Helper == 196 ~ "1960",
                               Helper == 197 ~ "1970",
                               Helper == 198 ~ "1980",
                               Helper == 199 ~ "1990",
                               Helper == 200 ~ "2000",
                               Helper == 201 ~ "2010",
                               Helper == 202 ~ "2020")
)


MountEverestData$Helper <- NULL
#View(MountEverestData)
head(MountEverestData, 10)
```

1. Our population of interest are the all of the adults that climbed Mount Everest from 1953 through 1920

2. One parameter of interest is the population age. The population mean age is 34.69089. 
```{r}
mu = mean(MountEverestData$Age)
mu

avg = sum(MountEverestData$Age) / length(MountEverestData$Age)
avg
```
3. Sample Size for Stratified Random Sampling 
- As we can see Yr.Seas and Citizenship have way too many possible strata 
- Host , Oxy, Death, and Sex do not seem to have different variability. 
- We made Decade a variable and that looks like it has a lot of variability 
```{r}
#Trying to find Strata
ggplot(
  data = MountEverestData, 
  aes(x = Host, y = Age)) +
  geom_boxplot()  + 
  labs(title = "Host vs. Age")

ggplot(
  data = MountEverestData, 
  aes(x = Yr.Seas, y = Age)) +
  geom_boxplot()  + 
  theme(axis.text.x = element_text(angle = 90)) +
  labs(title = "Year vs. Age")

ggplot(
  data = MountEverestData, 
  aes(x = Citizenship, y = Age)) +
  geom_boxplot()  + 
  theme(axis.text.x = element_text(angle = 90)) +
  labs(title = "Citizenship vs. Age")

ggplot(
  data = MountEverestData, 
  aes(x = Sex, y = Age)) +
  geom_boxplot()  + 
  theme(axis.text.x = element_text(angle = 90)) +
  labs(title = "Sex vs. Age")

ggplot(
  data = MountEverestData, 
  aes(x = Oxy, y = Age)) +
  geom_boxplot()  + 
  theme(axis.text.x = element_text(angle = 90)) +
  labs(title = "Oxygen vs. Age")

ggplot(
  data = MountEverestData, 
  aes(x = Dth, y = Age)) +
  geom_boxplot()  + 
  theme(axis.text.x = element_text(angle = 90)) +
  labs(title = "Death vs. Age")

ggplot(
  data = MountEverestData, 
  aes(x = YearOnly, y = Age)) +
  geom_boxplot()  + 
  theme(axis.text.x = element_text(angle = 90)) +
  labs(title = "Year Only vs. Age")

ggplot(
  data = MountEverestData, 
  aes(x = Decade, y = Age)) +
  geom_boxplot()  + 
  theme(axis.text.x = element_text(angle = 90)) +
  labs(title = "Decade vs. Age")
```

Step 1: n = (sum (N_k * sd_k))^2 / N^2D + sum(N_i * sd_i)^2
```{r}
# Find N

Stratified <- 
MountEverestData %>%
  group_by(Sex) %>%
  summarise(n(), sd(Age), mean(Age))
Stratified %>%
  rename(count = "n()", 
         sd = "sd(Age)", 
         mean = "mean(Age)")


# Stratified <- 
# MountEverestData %>%
#   group_by(Decade) %>%
#   summarise(n(), sd(Age))
# Stratified %>%
#   rename(count = "n()")
```

We will use Neyman Allocation. So N = 10184, and we will make our Bound 3. So n = 47
```{r}
x = ((710 * 10.99570) + (9474 * 10.25151))^2
N = length(MountEverestData$Age)
B = 3
D = (B^2) / 4

y = ((710 * 10.99570^2) + (9474 * 10.25151^2))
n = x/((N^2 * D) + y)
n
```

4. Yes, the strata seem to be homogenous. Their means and variances look very similar.
```{r}
#a. 
#Creating first Dataset
StratifiedSample = sample(MountEverestData, 47, replace = FALSE)
StratifiedSample

#b. 
ggplot(
  data = MountEverestData, 
  aes(x = Sex, y = Age)) +
  geom_boxplot()  + 
  theme(axis.text.x = element_text(angle = 90)) +
  labs(title = "Sex vs. Age")
```
ybarst = (1/N) * sum(NiYi)
```{r}
#c 
StratifiedSample <- 
  StratifiedSample %>%
    group_by(Sex) %>%
    summarise(n(), sd(Age), mean(Age))
StratifiedSample %>%
  rename(count = "n()", 
         sd = "sd(Age)", 
         mean = "mean(Age)")
StratifiedSample

y_bar_st = (1/10184) * ((710 * ) + (9474 * 34.66772))
y_bar_st

Var_st = (1/(10184^2)) * (((710^2)*(1 - (5/710))*((6.09918^2) / 5)) + ((9474^2)*(1 - (42/9474)) * ((11.18592^2) / 5)))
Var_st

```

